{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4dc2bc32579df35be38d","webpack:///./src/index.js","webpack:///./src/interface/index.js","webpack:///./src/interface/client.js","webpack:///./src/conf/index.js","webpack:///./src/conf/config.js","webpack:///./src/conf/constants.js","webpack:///./src/drivers/index.js","webpack:///./src/drivers/receive/index.js","webpack:///./src/lib/index.js","webpack:///./src/lib/promise.js","webpack:///./~/sync-browser-mocks/src/promise.js","webpack:///./src/lib/tick.js","webpack:///./src/lib/util.js","webpack:///./src/lib/log.js","webpack:///./src/lib/windows.js","webpack:///./src/global.js","webpack:///./src/lib/cleanup.js","webpack:///./src/lib/methods.js","webpack:///./src/lib/ready.js","webpack:///./src/compat/index.js","webpack:///./src/compat/ie.js","webpack:///./src/drivers/receive/types.js","webpack:///./src/drivers/send/index.js","webpack:///./src/drivers/send/strategies.js","webpack:///./src/bridge/index.js","webpack:///./src/bridge/bridge.js","webpack:///./src/bridge/child.js","webpack:///./src/bridge/common.js","webpack:///./src/bridge/parent.js","webpack:///./src/drivers/listeners.js","webpack:///./src/interface/server.js","webpack:///./src/interface/config.js"],"names":["init","reset","Promise","initialized","clean","all","then","module","exports","openBridge","linkUrl","isBridge","needsBridge","needsBridgeForBrowser","needsBridgeForWin","needsBridgeForDomain","openTunnelToOpener","destroyBridges","util","windowUtil","parent","winutil","request","sendToParent","client","options","nodeify","resolve","reject","name","Error","MOCK_MODE","window","el","document","getElementById","tagName","toLowerCase","contentWindow","HTMLElement","domain","hash","uniqueID","setItem","listeners","response","hasResult","respond","err","result","run","type","POST_MESSAGE_TYPE","REQUEST","data","fireAndForget","ackTimeout","intervalTimeout","ACK_TIMEOUT","ack","cancel","remaining","timeout","callback","send","win","CONFIG","ALLOW_POSTMESSAGE_POPUP","__TEST__","LOG_LEVEL","BRIDGE_TIMEOUT","LOG_TO_PAGE","ALLOWED_POST_MESSAGE_METHODS","SEND_STRATEGIES","POST_MESSAGE","BRIDGE","GLOBAL","location","href","indexOf","FILE_PROTOCOL","CONSTANTS","RESPONSE","ACK","POST_MESSAGE_ACK","SUCCESS","ERROR","POST_MESSAGE_NAMES","METHOD","READY","OPEN_TUNNEL","WINDOW_TYPES","FULLPAGE","POPUP","IFRAME","WINDOW_PROPS","POSTROBOT","SERIALIZATION_TYPES","MOCK_PROTOCOL","BRIDGE_NAME_PREFIX","POSTROBOT_PROXY","POST_MESSAGE_NAMES_LIST","Object","keys","map","key","receiveMessage","messageListener","listenForMessages","receivedMessages","parseMessage","message","event","closed","source","origin","sourceDomain","id","push","level","logLevel","replace","debug","sourceElement","originalEvent","listener","listen","register","promise","method","nextTick","promiseWrapper","apply","prom","deNodeify","args","length","items","results","i","patchPromise","trycatch","successHandler","errorHandler","isCalled","isSuccess","isError","res","flush","error","possiblyUnhandledPromiseHandlers","possiblyUnhandledPromises","possiblyUnhandledPromiseTimeout","addPossiblyUnhandledPromise","setTimeout","flushPossiblyUnhandledPromises","promises","silentReject","handlers","onError","dispatchError","dispatch","dispatchedErrors","j","toString","isPromise","item","Window","constructor","call","Function","SyncPromise","handler","resolved","rejected","self","SyncPromiseResolve","value","prototype","asyncReject","shift","onSuccess","count","onPossiblyUnhandledException","syncPromiseOnPossiblyUnhandledException","syncPromiseTry","delay","syncPromiseDelay","obj","hasOwnProperty","promisifyCall","Array","slice","arguments","tickMessageName","queue","addEventListener","postMessage","once","called","onceWrapper","noop","safeHasProp","safeGetProp","attachEvent","removeEventListener","detachEvent","context","find","collection","def","some","Boolean","mapping","values","getByValue","chars","charAt","Math","floor","random","memoize","memoized","JSON","stringify","extend","each","isArray","replaceObject","depth","newobj","undefined","safeInterval","time","runInterval","clearTimeout","interval","getDomain","mockDomain","protocol","host","getDomainFromUrl","url","match","split","join","safeGet","prop","LOG_LEVELS","bind","console","log","forEach","clearLogs","clear","container","parentNode","removeChild","writeToPage","createElement","style","cssText","body","appendChild","date","Date","payload","json","e","msg","innerHTML","color","warn","info","childNodes","insertBefore","unshift","pathname","isSameDomain","getOpener","getParent","getParents","isAncestorParent","getFrames","getAllChildFrames","getAllFramesInWindow","getTop","isWindowClosed","getUserAgent","getFrameByName","findChildFrameByName","findFrameByName","isParent","isOpener","getAncestor","getAncestors","isAncestor","isPopup","isIframe","isFullpage","getWindowType","isSameTopWindow","jsonStringify","jsonParse","domainMatches","domainMatchTimeout","opener","child","childParent","frames","len","frame","childFrame","top","allowMock","navigator","mockUserAgent","userAgent","winFrames","namedFrame","frameParent","ancestor","actualParent","anyMatch","collection1","collection2","item1","item2","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","objectToJSON","arrayToJSON","toJSON","parse","global","registerSelf","cleanup","tasks","getters","array","object","set","index","splice","complete","hasTasks","filter","pop","toClean","serializeMethod","serializeMethods","deserializeMethod","deserializeError","deserializeMethods","methods","listenForMethods","meth","destination","isSerialized","__type__","__id__","__name__","serializeError","__message__","stack","wrapper","initOnReady","onWindowReady","readyPromises","emulateIERestrictions","sourceWindow","targetWindow","matchDomain","RECEIVE_MESSAGE_TYPES","target","originalSource","handleError","buildMessage","sendMessage","windowType","messages","serializedMessage","strategyName","success","status","SEND_MESSAGE_STRATEGIES","foreignGlobal","openTunnelToParent","canary","remoteWindow","getRemoteBridgeForWindow","setInterval","clearInterval","bridge","getBridgeName","registerRemoteWindow","findRemoteWindow","registerRemoteSendMessage","rejectRemoteSendMessage","sendBridgeMessage","sanitizedDomain","documentBodyReady","remoteWindows","sendMessagePromise","sendMessageWrapper","remoteWin","remoteDomain","messagingChild","messagingParent","bridges","listenForRegister","winDetails","popupWindows","openBridgeFrame","iframe","setAttribute","src","onload","onerror","windowOpen","open","last","winOptions","resetListeners","getRequestListener","removeRequestListener","addRequestListener","isRegex","requestListener","specifiedWin","specifiedDomain","matchedWin","matchedDomain","override","errorOnClose","on","myListener","enableMockMode","disableMockMode","disable"],"mappings":"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","file":"post-robot.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"postRobot\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postRobot\"] = factory();\n\telse\n\t\troot[\"postRobot\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4dc2bc32579df35be38d","\nimport { initOnReady, listenForMethods } from './lib';\nimport { listenForMessages } from './drivers';\nimport { global } from './global';\nimport { openTunnelToOpener } from './bridge';\n\nexport function init() {\n\n    if (!global.initialized) {\n        listenForMessages();\n        openTunnelToOpener();\n        initOnReady();\n        listenForMethods();\n    }\n\n    global.initialized = true;\n}\n\ninit();\n\nexport function reset() {\n    return global.clean.all().then(() => {\n        global.initialized = false;\n        return init();\n    });\n}\n\nexport * from './interface';\nexport { Promise } from './lib';\n\nexport default module.exports;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","\nimport { getAncestor } from '../lib/windows';\n\nexport * from './client';\nexport * from './server';\nexport * from './config';\n\nimport * as windowUtil from '../lib/windows';\n\nexport let parent = getAncestor();\n\nexport { openBridge, linkUrl, isBridge, needsBridge, needsBridgeForBrowser, needsBridgeForWin, needsBridgeForDomain, openTunnelToOpener, destroyBridges } from '../bridge';\n\nexport { util } from '../lib/util';\n\nexport let winutil = windowUtil;\n\n\n\n// WEBPACK FOOTER //\n// ./src/interface/index.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { sendMessage } from '../drivers';\nimport { global } from '../global';\nimport { util, promise, getAncestor, isAncestor, onWindowReady, isWindowClosed } from '../lib';\n\n\nexport function request(options) {\n\n    return promise.nodeify(new promise.Promise((resolve, reject) => {\n\n        if (!options.name) {\n            throw new Error('Expected options.name');\n        }\n\n        \n        if (CONFIG.MOCK_MODE) {\n            options.window = window;\n\n        } else if (typeof options.window === 'string') {\n            let el = document.getElementById(options.window);\n\n            if (!el) {\n                throw new Error(`Expected options.window ${options.window} to be a valid element id`);\n            }\n\n            if (el.tagName.toLowerCase() !== 'iframe') {\n                throw new Error(`Expected options.window ${options.window} to be an iframe`);\n            }\n\n            if (!el.contentWindow) {\n                throw new Error('Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.');\n            }\n\n            options.window = el.contentWindow;\n\n            \n        } else if (options.window instanceof HTMLElement) {\n            \n            if (options.window.tagName.toLowerCase() !== 'iframe') {\n                throw new Error(`Expected options.window ${options.window} to be an iframe`);\n            }\n\n            if (!options.window.contentWindow) {\n                throw new Error('Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.');\n            }\n            \n            options.window = options.window.contentWindow;\n        }\n\n        if (!options.window) {\n            throw new Error('Expected options.window to be a window object, iframe, or iframe element id.');\n        }\n\n        options.domain = options.domain || '*';\n\n        let hash = `${options.name}_${util.uniqueID()}`;\n        global.clean.setItem(global.listeners.response, hash, options);\n\n        if (isWindowClosed(options.window)) {\n            throw new Error('Target window is closed');\n        }\n\n        let hasResult = false;\n\n        options.respond = (err, result) => {\n            if (!err) {\n                hasResult = true;\n            }\n\n            return err ? reject(err) : resolve(result);\n        };\n\n        return promise.run(() => {\n\n            if (isAncestor(window, options.window)) {\n                return onWindowReady(options.window);\n            }\n\n        }).then(() => {\n\n            sendMessage(options.window, {\n                hash,\n                type: CONSTANTS.POST_MESSAGE_TYPE.REQUEST,\n                name: options.name,\n                data: options.data,\n                fireAndForget: options.fireAndForget\n            }, options.domain).catch(reject);\n\n            if (options.fireAndForget) {\n                return resolve();\n            }\n\n            let ackTimeout = util.intervalTimeout(CONFIG.ACK_TIMEOUT, 100, remaining => {\n\n                if (options.ack || isWindowClosed(options.window)) {\n                    return ackTimeout.cancel();\n                }\n\n                if (!remaining) {\n                    return reject(new Error(`No ack for postMessage ${options.name} in ${CONFIG.ACK_TIMEOUT}ms`));\n                }\n            });\n\n            if (options.timeout) {\n                let timeout = util.intervalTimeout(options.timeout, 100, remaining => {\n\n                    if (hasResult || isWindowClosed(options.window)) {\n                        return timeout.cancel();\n                    }\n\n                    if (!remaining) {\n                        return reject(new Error(`Post message response timed out after ${options.timeout} ms`));\n                    }\n\n                }, options.timeout);\n            }\n\n        }).catch(reject);\n\n    }), options.callback);\n}\n\nexport function send(window, name, data, options, callback) {\n\n    if (!callback) {\n        if (!options && typeof data === 'function') {\n            callback = data;\n            options = {};\n            data = {};\n        } else if (typeof options === 'function') {\n            callback = options;\n            options = {};\n        }\n    }\n\n    options = options || {};\n    options.window = window;\n    options.name = name;\n    options.data = data;\n    options.callback = callback;\n\n    return request(options);\n}\n\nexport function sendToParent(name, data, options, callback) {\n\n    let win = getAncestor();\n\n    if (!win) {\n        return new promise.Promise((resolve, reject) => reject(new Error('Window does not have a parent')));\n    }\n\n    return send(win, name, data, options, callback);\n}\n\nexport function client(options = {}) {\n\n    if (!options.window) {\n        throw new Error(`Expected options.window`);\n    }\n\n    return {\n        send(name, data, callback) {\n            return send(options.window, name, data, options, callback);\n        }\n    };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/interface/client.js","\nexport * from './config';\nexport * from './constants';\n\n\n// WEBPACK FOOTER //\n// ./src/conf/index.js","\nimport { CONSTANTS } from './constants';\n\nexport let CONFIG = {\n    \n    ALLOW_POSTMESSAGE_POPUP: __TEST__ ? false : true,\n\n    LOG_LEVEL: 'info',\n\n    BRIDGE_TIMEOUT: 5000,\n    ACK_TIMEOUT: 1000,\n\n    LOG_TO_PAGE: false,\n    \n    MOCK_MODE: false,\n\n    ALLOWED_POST_MESSAGE_METHODS: {\n        [ CONSTANTS.SEND_STRATEGIES.POST_MESSAGE ]: true,\n        [ CONSTANTS.SEND_STRATEGIES.BRIDGE ]: true,\n        [ CONSTANTS.SEND_STRATEGIES.GLOBAL ]: true\n    }\n};\n\nif (window.location.href.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n    CONFIG.ALLOW_POSTMESSAGE_POPUP = true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/conf/config.js","\nexport let CONSTANTS = {\n\n    POST_MESSAGE_TYPE: {\n        REQUEST: 'postrobot_message_request',\n        RESPONSE: 'postrobot_message_response',\n        ACK: 'postrobot_message_ack'\n    },\n\n    POST_MESSAGE_ACK: {\n        SUCCESS: 'success',\n        ERROR: 'error'\n    },\n\n    POST_MESSAGE_NAMES: {\n        METHOD: 'postrobot_method',\n        READY: 'postrobot_ready',\n        OPEN_TUNNEL: 'postrobot_open_tunnel'\n    },\n\n    WINDOW_TYPES: {\n        FULLPAGE: 'fullpage',\n        POPUP: 'popup',\n        IFRAME: 'iframe'\n    },\n\n    WINDOW_PROPS: {\n        POSTROBOT: '__postRobot__'\n    },\n\n    SERIALIZATION_TYPES: {\n        METHOD: 'postrobot_method',\n        ERROR: 'postrobot_error'\n    },\n\n    SEND_STRATEGIES: {\n        POST_MESSAGE: 'postrobot_post_message',\n        BRIDGE: 'postrobot_bridge',\n        GLOBAL: 'postrobot_global'\n    },\n\n    MOCK_PROTOCOL: 'mock:',\n    FILE_PROTOCOL: 'file:',\n\n    BRIDGE_NAME_PREFIX: '__postrobot_bridge__',\n    POSTROBOT_PROXY: '__postrobot_proxy__'\n};\n\nexport let POST_MESSAGE_NAMES_LIST = Object.keys(CONSTANTS.POST_MESSAGE_NAMES).map(key => CONSTANTS.POST_MESSAGE_NAMES[key]);\n\n\n\n// WEBPACK FOOTER //\n// ./src/conf/constants.js","\nexport * from './receive';\nexport * from './send';\nexport * from './listeners';\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/index.js","\nimport { CONSTANTS, POST_MESSAGE_NAMES_LIST } from '../../conf';\nimport { deserializeMethods, log, isWindowClosed, jsonParse, util } from '../../lib';\nimport { emulateIERestrictions } from '../../compat';\nimport { global } from '../../global';\n\nimport { RECEIVE_MESSAGE_TYPES } from './types';\n\nglobal.receivedMessages = global.receivedMessages || [];\n\nfunction parseMessage(message) {\n\n    try {\n        message = jsonParse(message);\n    } catch (err) {\n        return;\n    }\n\n    if (!message) {\n        return;\n    }\n\n    message = message[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n\n    if (!message) {\n        return;\n    }\n\n    if (!message.type) {\n        return;\n    }\n\n    if (!RECEIVE_MESSAGE_TYPES[message.type]) {\n        return;\n    }\n\n    return message;\n}\n\n\nexport function receiveMessage(event) {\n\n    if (!window || window.closed) {\n        throw new Error(`Message recieved in closed window`);\n    }\n\n    try {\n        if (!event.source) {\n            return;\n        }\n    } catch (err) {\n        return;\n    }\n\n    let { source, origin, data } = event;\n\n    let message = parseMessage(data);\n\n    if (!message) {\n        return;\n    }\n\n    if (message.sourceDomain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0 || message.sourceDomain.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n        origin = message.sourceDomain;\n    }\n\n    if (global.receivedMessages.indexOf(message.id) === -1) {\n        global.clean.push(global.receivedMessages, message.id);\n    } else {\n        return;\n    }\n\n    let level;\n\n    if (POST_MESSAGE_NAMES_LIST.indexOf(message.name) !== -1 || message.type === CONSTANTS.POST_MESSAGE_TYPE.ACK) {\n        level = 'debug';\n    } else if (message.ack === 'error') {\n        level = 'error';\n    } else {\n        level = 'info';\n    }\n\n    log.logLevel(level, [ '\\n\\n\\t', '#receive', message.type.replace(/^postrobot_message_/, ''), '::', message.name, '::', origin, '\\n\\n', message ]);\n\n    if (isWindowClosed(source)) {\n        return log.debug(`Source window is closed - can not send ${message.type} ${message.name}`);\n    }\n\n    if (message.data) {\n        message.data = deserializeMethods(source, origin, message.data);\n    }\n\n    RECEIVE_MESSAGE_TYPES[message.type](source, origin, message);\n}\n\nexport function messageListener(event) {\n\n    try {\n        event.source // eslint-disable-line\n    } catch (err) {\n        return;\n    }\n\n    event = {\n        source: event.source || event.sourceElement,\n        origin: event.origin || event.originalEvent.origin,\n        data: event.data\n    };\n\n    try {\n        emulateIERestrictions(event.source, window);\n    } catch (err) {\n        return;\n    }\n\n    receiveMessage(event);\n}\n\nexport function listenForMessages() {\n    let listener = util.listen(window, 'message', messageListener);\n\n    global.clean.register('listener', () => {\n        listener.cancel();\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/receive/index.js","\nexport * from './promise';\nexport * from './util';\nexport * from './log';\nexport * from './windows';\nexport * from './methods';\nexport * from './tick';\nexport * from './ready';\nexport * from './cleanup';\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/index.js","\nimport { SyncPromise } from 'sync-browser-mocks/src/promise';\nimport { nextTick } from './tick';\n\nexport let Promise = SyncPromise;\n\nexport let promise = {\n\n    Promise,\n\n    run(method) {\n        return Promise.resolve().then(method);\n    },\n\n    nextTick(method) {\n        return new Promise((resolve, reject) => {\n            nextTick(() => {\n                return promise.run(method).then(resolve, reject);\n            });\n        });\n    },\n\n    method(method) {\n        return function promiseWrapper() {\n            return Promise.resolve().then(() => {\n                return method.apply(this, arguments);\n            });\n        };\n    },\n\n    nodeify(prom, callback) {\n        if (!callback) {\n            return prom;\n        }\n        prom.then(result => {\n            callback(null, result);\n        }, err => {\n            callback(err);\n        });\n    },\n\n    deNodeify(method, ...args) {\n        return new Promise((resolve, reject) => {\n            try {\n                if (args.length < method.length) {\n                    return method(...args, (err, result) => {\n                        return err ? reject(err) : resolve(result);\n                    });\n                }\n\n                return promise.run(() => {\n                    return method(...args);\n                }).then(resolve, reject);\n\n            } catch (err) {\n                return reject(err);\n            }\n        });\n    },\n\n    map(items, method) {\n\n        let results = [];\n        for (let i = 0; i < items.length; i++) {\n            results.push(promise.run(() => {\n                return method(items[i]);\n            }));\n        }\n        return Promise.all(results);\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/promise.js","\nfunction trycatch(method, successHandler, errorHandler) {\n\n    let isCalled = false;\n    let isSuccess = false;\n    let isError = false;\n    let err, res;\n\n    function flush() {\n        if (isCalled) {\n            if (isError) {\n                return errorHandler(err);\n            } else if (isSuccess) {\n                return successHandler(res);\n            }\n        }\n    }\n\n    try {\n        method(function(result) {\n            res = result;\n            isSuccess = true;\n            flush();\n        }, function(error) {\n            err = error;\n            isError = true;\n            flush();\n        });\n    } catch (error) {\n        return errorHandler(error);\n    }\n\n    isCalled = true;\n    flush();\n}\n\nlet possiblyUnhandledPromiseHandlers = [];\nlet possiblyUnhandledPromises = [];\nlet possiblyUnhandledPromiseTimeout;\n\nfunction addPossiblyUnhandledPromise(promise) {\n    possiblyUnhandledPromises.push(promise);\n    possiblyUnhandledPromiseTimeout = possiblyUnhandledPromiseTimeout || setTimeout(flushPossiblyUnhandledPromises, 1);\n}\n\nfunction flushPossiblyUnhandledPromises() {\n\n    possiblyUnhandledPromiseTimeout = null;\n    let promises = possiblyUnhandledPromises;\n    possiblyUnhandledPromises = [];\n\n    for (let i = 0; i < promises.length; i++) {\n        let promise = promises[i];\n\n        if (promise.silentReject) {\n            continue;\n        }\n\n        promise.handlers.push({\n            onError(err) {\n                if (promise.silentReject) {\n                    return;\n                }\n\n                dispatchError(err);\n            }\n        });\n\n        promise.dispatch();\n    }\n}\n\nlet dispatchedErrors = [];\n\nfunction dispatchError(err) {\n\n    if (dispatchedErrors.indexOf(err) !== -1) {\n        return;\n    }\n\n    dispatchedErrors.push(err);\n\n    setTimeout(() => {\n        throw err;\n    }, 1);\n\n    for (let j = 0; j < possiblyUnhandledPromiseHandlers.length; j++) {\n        possiblyUnhandledPromiseHandlers[j](err);\n    }\n}\n\n\nlet toString = ({}).toString;\n\nfunction isPromise(item) {\n    try {\n        if (!item) {\n            return false;\n        }\n\n        if (window.Window && item instanceof window.Window) {\n            return false;\n        }\n\n        if (window.constructor && item instanceof window.constructor) {\n            return false;\n        }\n\n        if (toString) {\n            let name = toString.call(item);\n\n            if (name === '[object Window]' || name === '[object global]' || name === '[object DOMWindow]') {\n                return false;\n            }\n        }\n\n        if (item && item.then instanceof Function) {\n            return true;\n        }\n    } catch (err) {\n        return false\n    }\n\n    return false\n}\n\nexport let SyncPromise = function SyncPromise(handler) {\n\n    this.resolved = false;\n    this.rejected = false;\n\n    this.silentReject = false;\n\n    this.handlers = [];\n\n    addPossiblyUnhandledPromise(this);\n\n    if (!handler) {\n        return;\n    }\n\n    let self = this;\n\n    trycatch(handler, function(res) {\n        return self.resolve(res);\n    }, function(err) {\n        return self.reject(err);\n    });\n};\n\nSyncPromise.resolve = function SyncPromiseResolve(value) {\n\n    if (isPromise(value)) {\n        return value;\n    }\n\n    return new SyncPromise().resolve(value);\n};\n\nSyncPromise.reject = function SyncPromiseResolve(error) {\n    return new SyncPromise().reject(error);\n};\n\nSyncPromise.prototype.resolve = function (result) {\n    if (this.resolved || this.rejected) {\n        return this;\n    }\n\n    if (isPromise(result)) {\n        throw new Error('Can not resolve promise with another promise');\n    }\n\n    this.resolved = true;\n    this.value = result;\n    this.dispatch();\n\n    return this;\n};\n\nSyncPromise.prototype.reject = function(error) {\n    if (this.resolved || this.rejected) {\n        return this;\n    }\n\n    if (isPromise(error)) {\n        throw new Error('Can not reject promise with another promise');\n    }\n\n    this.rejected = true;\n    this.value = error;\n    this.dispatch();\n\n    return this;\n};\n\nSyncPromise.prototype.asyncReject = function(error) {\n    this.silentReject = true;\n    this.reject(error);\n}\n\nSyncPromise.prototype.dispatch = function() {\n\n    if (!this.resolved && !this.rejected) {\n        return;\n    }\n\n    while (this.handlers.length) {\n\n        let handler = this.handlers.shift();\n\n        let result, error;\n\n        try {\n            if (this.resolved) {\n                result = handler.onSuccess ? handler.onSuccess(this.value) : this.value;\n            } else if (this.rejected) {\n                if (handler.onError) {\n                    result = handler.onError(this.value);\n                } else {\n                    error = this.value;\n                }\n            }\n        } catch (err) {\n            error = err;\n        }\n\n        if (result === this) {\n            throw new Error('Can not return a promise from the the then handler of the same promise');\n        }\n\n        if (!handler.promise) {\n            continue;\n        }\n\n        if (error) {\n            handler.promise.reject(error);\n\n        } else if (isPromise(result)) {\n            result.then(res => { handler.promise.resolve(res); },\n                        err => { handler.promise.reject(err);  });\n\n        } else {\n            handler.promise.resolve(result);\n        }\n    }\n};\n\nSyncPromise.prototype.then = function(onSuccess, onError) {\n\n    if (onSuccess && typeof onSuccess !== 'function' && !onSuccess.call) {\n        throw new Error('Promise.then expected a function for success handler');\n    }\n\n    if (onError && typeof onError !== 'function' && !onError.call) {\n        throw new Error('Promise.then expected a function for error handler');\n    }\n\n    let promise = new SyncPromise(null, this);\n\n    this.handlers.push({\n        promise: promise,\n        onSuccess: onSuccess,\n        onError: onError\n    });\n\n    this.silentReject = true;\n\n    this.dispatch();\n\n    return promise;\n};\n\nSyncPromise.prototype.catch = function(onError) {\n    return this.then(null, onError);\n};\n\nSyncPromise.prototype.finally = function(handler) {\n    return this.then(function(result) {\n        return SyncPromise.try(handler)\n            .then(() => {\n                return result;\n            });\n    }, function(err) {\n        return SyncPromise.try(handler)\n            .then(() => {\n                throw err;\n            });\n    });\n};\n\nSyncPromise.all = function(promises) {\n\n    let promise = new SyncPromise();\n    let count = promises.length;\n    let results = [];\n\n    for (let i = 0; i < promises.length; i++) {\n\n        let prom = isPromise(promises[i]) ? promises[i] : SyncPromise.resolve(promises[i]);\n\n        prom.then(function(result) {\n            results[i] = result;\n            count -= 1;\n            if (count === 0) {\n                promise.resolve(results);\n            }\n        }, function(err) {\n            promise.reject(err);\n        });\n    }\n\n    if (!count) {\n        promise.resolve(results);\n    }\n\n    return promise;\n};\n\nSyncPromise.onPossiblyUnhandledException = function syncPromiseOnPossiblyUnhandledException(handler) {\n    possiblyUnhandledPromiseHandlers.push(handler);\n};\n\nSyncPromise.try = function syncPromiseTry(method) {\n    return SyncPromise.resolve().then(method);\n}\n\nSyncPromise.delay = function syncPromiseDelay(delay) {\n    return new SyncPromise(resolve => {\n        setTimeout(resolve, delay);\n    });\n}\n\nSyncPromise.hash = function(obj) {\n\n    let results = {};\n    let promises = [];\n\n    for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            promises.push(SyncPromise.resolve(obj[key]).then(result => {\n                results[key] = result;\n            }));\n        }\n    }\n\n    return SyncPromise.all(promises).then(() => {\n        return results;\n    });\n}\n\nSyncPromise.promisifyCall = function() {\n\n    let args = Array.prototype.slice.call(arguments);\n    let method = args.shift();\n\n    if (typeof method !== 'function') {\n        throw new Error(`Expected promisifyCall to be called with a function`);\n    }\n\n    return new SyncPromise((resolve, reject) => {\n\n        args.push((err, result) => {\n            return err ? reject(err) : resolve(result);\n        });\n\n        return method.apply(null, args);\n    });\n}\n\n\nexport function patchPromise() {\n    window.Promise = SyncPromise;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./~/sync-browser-mocks/src/promise.js","\nimport { util } from './util';\n\nlet tickMessageName = `__nextTick__postRobot__${util.uniqueID()}`;\nlet queue = [];\n\nwindow.addEventListener('message', event => {\n    if (event.data === tickMessageName) {\n        let method = queue.shift();\n        method.call();\n    }\n});\n\nexport function nextTick(method) {\n\n    queue.push(method);\n    window.postMessage(tickMessageName, '*');\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/tick.js","\nimport { CONSTANTS } from '../conf';\n\nexport let util = {\n\n    once(method) {\n        if (!method) {\n            return method;\n        }\n        let called = false;\n        return function onceWrapper() {\n            if (!called) {\n                called = true;\n                return method.apply(this, arguments);\n            }\n        };\n    },\n\n    noop() {}, // eslint-disable-line no-empty-function\n\n    safeHasProp(obj, name) {\n        try {\n            if (obj[name]) {\n                return true;\n            } else {\n                return false;\n            }\n        } catch (err) {\n            return false;\n        }\n    },\n\n    safeGetProp(obj, name) {\n        try {\n            return obj[name];\n        } catch (err) {\n            return;\n        }\n    },\n\n    listen(win, event, handler) {\n        if (win.addEventListener) {\n            win.addEventListener(event, handler);\n        } else {\n            win.attachEvent(`on${event}`, handler);\n        }\n\n        return {\n            cancel() {\n                if (win.removeEventListener) {\n                    win.removeEventListener(event, handler);\n                } else {\n                    win.detachEvent(`on${event}`, handler);\n                }\n            }\n        };\n    },\n\n    apply(method, context, args) {\n        if (typeof method.apply === 'function') {\n            return method.apply(context, args);\n        }\n        return method(args[0], args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8], args[9]);\n    },\n\n    find(collection, method, def) {\n        if (!collection) {\n            return def;\n        }\n        for (let i = 0; i < collection.length; i++) {\n            if (method(collection[i])) {\n                return collection[i];\n            }\n        }\n        return def;\n    },\n\n    map(collection, method) {\n        let results = [];\n        for (let i = 0; i < collection.length; i++) {\n            results.push(method(collection[i]));\n        }\n        return results;\n    },\n\n    some(collection, method) {\n        method = method || Boolean;\n        for (let i = 0; i < collection.length; i++) {\n            if (method(collection[i])) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    keys(mapping) {\n        let result = [];\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key)) {\n                result.push(key);\n            }\n        }\n        return result;\n    },\n\n    values(mapping) {\n        let result = [];\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key)) {\n                result.push(mapping[key]);\n            }\n        }\n        return result;\n    },\n\n    getByValue(mapping, value) {\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key) && mapping[key] === value) {\n                return key;\n            }\n        }\n    },\n\n    uniqueID() {\n\n        let chars = '0123456789abcdef';\n\n        return 'xxxxxxxxxx'.replace(/./g, () => {\n            return chars.charAt(Math.floor(Math.random() * chars.length));\n        });\n    },\n\n    memoize(method) {\n\n        let results = {};\n\n        return function memoized() {\n            let args = JSON.stringify(Array.prototype.slice.call(arguments));\n            if (!results.hasOwnProperty(args)) {\n                results[args] = method.apply(this, arguments);\n            }\n            return results[args];\n        };\n    },\n\n    extend(obj, source) {\n        if (!source) {\n            return obj;\n        }\n\n        for (let key in source) {\n            if (source.hasOwnProperty(key)) {\n                obj[key] = source[key];\n            }\n        }\n\n        return obj;\n    },\n\n    each(obj, callback) {\n        if (Array.isArray(obj)) {\n            for (let i = 0; i < obj.length; i++) {\n                callback(obj[i], i);\n            }\n        } else if (typeof obj === 'object' && obj !== null) {\n            for (let key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    callback(obj[key], key);\n                }\n            }\n        }\n    },\n\n    replaceObject(obj, callback, depth = 1) {\n\n        if (depth >= 100) {\n            throw new Error(`Self-referential object passed, or object contained too many layers`);\n        }\n\n        let newobj = Array.isArray(obj) ? [] : {};\n\n        util.each(obj, (item, key) => {\n\n            let result = callback(item, key);\n\n            if (result !== undefined) {\n                newobj[key] = result;\n            } else if (typeof item === 'object' && item !== null) {\n                newobj[key] = util.replaceObject(item, callback, depth + 1);\n            } else {\n                newobj[key] = item;\n            }\n        });\n\n        return newobj;\n    },\n\n    safeInterval(method, time) {\n        let timeout;\n\n        function runInterval() {\n            timeout = setTimeout(runInterval, time);\n            method.call();\n        }\n\n        timeout = setTimeout(runInterval, time);\n\n        return {\n            cancel() {\n                clearTimeout(timeout);\n            }\n        };\n    },\n\n    intervalTimeout(time, interval, method) {\n\n        let safeInterval = util.safeInterval(() => {\n            time -= interval;\n\n            time = time <= 0 ? 0 : time;\n\n            if (time === 0) {\n                safeInterval.cancel();\n            }\n\n            method(time);\n        }, interval);\n\n        return safeInterval;\n    },\n\n    getDomain(win) {\n\n        win = win || window;\n\n        if (win.mockDomain && win.mockDomain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n            return win.mockDomain;\n        }\n\n        if (!win.location.protocol) {\n            throw new Error(`Can not read window protocol`);\n        }\n\n        if (win.location.protocol === CONSTANTS.FILE_PROTOCOL) {\n            return `${win.location.protocol}//${win.location.host}`;\n        }\n\n        if (!win.location.host) {\n            throw new Error(`Can not read window host`);\n        }\n\n        return `${win.location.protocol}//${win.location.host}`;\n    },\n\n    getDomainFromUrl(url) {\n\n        let domain;\n\n        if (url.match(/^(https?|mock|file):\\/\\//)) {\n            domain = url;\n        } else {\n            return this.getDomain();\n        }\n\n        domain = domain.split('/').slice(0, 3).join('/');\n\n        return domain;\n    },\n\n    safeGet(obj, prop) {\n\n        let result;\n\n        try {\n            result = obj[prop];\n        } catch (err) {\n            // pass\n        }\n\n        return result;\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/util.js","\nimport { util } from './util';\nimport { getWindowType, jsonStringify } from './windows';\nimport { CONFIG } from '../conf';\n\nconst LOG_LEVELS = ['debug', 'info', 'warn', 'error'];\n\nif (Function.prototype.bind && window.console && typeof console.log === 'object') {\n    [ 'log', 'info', 'warn', 'error' ].forEach(function(method) {\n        console[method] = this.bind(console[method], console);\n    }, Function.prototype.call);\n}\n\nexport let log = {\n\n    clearLogs() {\n\n        if (window.console && window.console.clear) {\n            window.console.clear();\n        }\n\n        if (CONFIG.LOG_TO_PAGE) {\n            let container = document.getElementById('postRobotLogs');\n\n            if (container) {\n                container.parentNode.removeChild(container);\n            }\n        }\n    },\n\n    writeToPage(level, args) {\n        setTimeout(() => {\n            let container = document.getElementById('postRobotLogs');\n\n            if (!container) {\n                container = document.createElement('div');\n                container.id = 'postRobotLogs';\n                container.style.cssText = 'width: 800px; font-family: monospace; white-space: pre-wrap;';\n                document.body.appendChild(container);\n            }\n\n            let el = document.createElement('div');\n\n            let date = (new Date()).toString().split(' ')[4];\n\n            let payload = util.map(args, item => {\n                if (typeof item === 'string') {\n                    return item;\n                }\n                if (!item) {\n                    return Object.prototype.toString.call(item);\n                }\n                let json;\n                try {\n                    json = jsonStringify(item, 0, 2);\n                } catch (e) {\n                    json = '[object]';\n                }\n\n                return `\\n\\n${json}\\n\\n`;\n            }).join(' ');\n\n\n            let msg = `${date} ${level} ${payload}`;\n            el.innerHTML = msg;\n\n            let color = {\n                log: '#ddd',\n                warn: 'orange',\n                error: 'red',\n                info: 'blue',\n                debug: '#aaa'\n            }[level];\n\n            el.style.cssText = `margin-top: 10px; color: ${color};`;\n\n            if (!container.childNodes.length) {\n                container.appendChild(el);\n            } else {\n                container.insertBefore(el, container.childNodes[0]);\n            }\n\n        });\n    },\n\n    logLevel(level, args) {\n        setTimeout(() => {\n            try {\n                if (LOG_LEVELS.indexOf(level) < LOG_LEVELS.indexOf(CONFIG.LOG_LEVEL)) {\n                    return;\n                }\n\n                args = Array.prototype.slice.call(args);\n\n                args.unshift(`${window.location.host}${window.location.pathname}`);\n                args.unshift(`::`);\n                args.unshift(`${getWindowType().toLowerCase()}`);\n                args.unshift('[post-robot]');\n\n                if (CONFIG.LOG_TO_PAGE) {\n                    log.writeToPage(level, args);\n                }\n\n                if (!window.console) {\n                    return;\n                }\n\n                if (!window.console[level]) {\n                    level = 'log';\n                }\n\n                if (!window.console[level]) {\n                    return;\n                }\n\n                window.console[level].apply(window.console, args);\n\n            } catch (err) {\n                // pass\n            }\n        }, 1);\n    },\n\n    debug() {\n        log.logLevel('debug', arguments);\n    },\n\n    info() {\n        log.logLevel('info', arguments);\n    },\n\n    warn() {\n        log.logLevel('warn', arguments);\n    },\n\n    error() {\n        log.logLevel('error', arguments);\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/log.js","\nimport { util } from './util';\nimport { global } from '../global';\nimport { CONSTANTS } from '../conf';\n\nglobal.domainMatches = global.domainMatches || [];\n\nlet domainMatchTimeout;\n\nexport function isSameDomain(win) {\n\n    for (let match of global.domainMatches) {\n        if (match.win === win) {\n            return match.match;\n        }\n    }\n\n    let match;\n\n    try {\n        if (util.getDomain(window) === util.getDomain(win)) {\n            match = true;\n        } else {\n            match = false;\n        }\n    } catch (err) {\n        match = false;\n    }\n\n    global.clean.push(global.domainMatches, { win, match });\n\n    if (!domainMatchTimeout) {\n        domainMatchTimeout = setTimeout(() => {\n            global.domainMatches = [];\n            domainMatchTimeout = null;\n        }, 1);\n    }\n\n    return match;\n}\n\n\nexport function getOpener(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        return win.opener;\n    } catch (err) {\n        return;\n    }\n}\n\nexport function getParent(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.parent && win.parent !== win) {\n            return win.parent;\n        }\n    } catch (err) {\n        return;\n    }\n}\n\n\n\nexport function getParents(win) {\n\n    let result = [];\n\n    try {\n\n        while (win.parent !== win) {\n            result.push(win.parent);\n            win = win.parent;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return result;\n}\n\nexport function isAncestorParent(parent, child) {\n\n    if (!parent || !child) {\n        return false;\n    }\n\n    let childParent = getParent(child);\n\n    if (childParent) {\n        return childParent === parent;\n    }\n\n    if (getParents(child).indexOf(parent) !== -1) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getFrames(win) {\n\n    let result = [];\n\n    let frames;\n\n    try {\n        frames = win.frames;\n    } catch (err) {\n        frames = win;\n    }\n\n    let len;\n\n    try {\n        len = frames.length;\n    } catch (err) {\n        // pass\n    }\n\n    if (len === 0) {\n        return result;\n    }\n\n    if (len) {\n        for (let i = 0; i < len; i++) {\n\n            let frame;\n\n            try {\n                frame = frames[i];\n            } catch (err) {\n                continue;\n            }\n\n            result.push(frame);\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < 100; i++) {\n        let frame;\n\n        try {\n            frame = frames[i];\n        } catch (err) {\n            return result;\n        }\n\n        if (!frame) {\n            return result;\n        }\n\n        result.push(frame);\n    }\n\n    return result;\n}\n\n\nexport function getAllChildFrames(win) {\n\n    let result = [];\n\n    for (let frame of getFrames(win)) {\n        result.push(frame);\n\n        for (let childFrame of getAllChildFrames(frame)) {\n            result.push(childFrame);\n        }\n    }\n\n    return result;\n}\n\nexport function getAllFramesInWindow(win) {\n\n    let result = getAllChildFrames(win);\n\n    result.push(win);\n\n    for (let parent of getParents(win)) {\n\n        result.push(parent);\n\n        for (let frame of getFrames(parent)) {\n\n            if (result.indexOf(frame) === -1) {\n                result.push(frame);\n            }\n        }\n    }\n\n    return result;\n}\n\nexport function getTop(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.top) {\n            return win.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    if (getParent(win) === win) {\n        return win;\n    }\n\n    try {\n        if (isAncestorParent(window, win)) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (isAncestorParent(win, window)) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    for (let frame of getAllChildFrames(win)) {\n        try {\n            if (frame.top) {\n                return frame.top;\n            }\n        } catch (err) {\n            // pass\n        }\n\n        if (getParent(frame) === frame) {\n            return frame;\n        }\n    }\n}\n\n\nexport function isWindowClosed(win, allowMock = true) {\n\n    try {\n        if (win === window) {\n            return false;\n        }\n    } catch (err) {\n        return true;\n    }\n\n\n    try {\n        if (!win) {\n            return true;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (win.closed) {\n            return true;\n        }\n\n    } catch (err) {\n\n        // I love you so much IE\n\n        if (err && err.message === 'Call was rejected by callee.\\r\\n') {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    if (allowMock && isSameDomain(win) && util.safeGet(win, 'mockclosed')) {\n        return true;\n    }\n\n    /*\n\n    // IE9... don't even ask. If an iframe is removed from the parent page, .closed does not get set to true\n\n    try {\n        if (win.parent === win && !getOpener(win) && win !== getTop(window)) {\n            // return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    */\n\n\n    return false;\n}\n\nexport function getUserAgent(win) {\n    win = win || window;\n    return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\n\n\nexport function getFrameByName(win, name) {\n\n    let winFrames = getFrames(win);\n\n    for (let childFrame of winFrames) {\n        try {\n            if (isSameDomain(childFrame) && childFrame.name === name && winFrames.indexOf(childFrame) !== -1) {\n                return childFrame;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    try {\n        if (winFrames.indexOf(win.frames[name]) !== -1) {\n            return win.frames[name];\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (winFrames.indexOf(win[name]) !== -1) {\n            return win[name];\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function findChildFrameByName(win, name) {\n\n    let frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        let namedFrame = findChildFrameByName(childFrame, name);\n\n        if (namedFrame) {\n            return namedFrame;\n        }\n    }\n}\n\nexport function findFrameByName(win, name) {\n\n    let frame;\n\n    frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    return findChildFrameByName(getTop(win), name);\n}\n\nexport function isParent(win, frame) {\n\n    let frameParent = getParent(frame);\n\n    if (frameParent) {\n        return frameParent === win;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        if (childFrame === frame) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isOpener(parent, child) {\n\n    return parent === getOpener(child);\n}\n\nexport function getAncestor(win) {\n    win = win || window;\n\n    let opener = getOpener(win);\n\n    if (opener) {\n        return opener;\n    }\n\n    let parent = getParent(win);\n\n    if (parent) {\n        return parent;\n    }\n}\n\nexport function getAncestors(win) {\n\n    let results = [];\n\n    let ancestor = win;\n\n    while (ancestor) {\n        ancestor = getAncestor(ancestor);\n        if (ancestor) {\n            results.push(ancestor);\n        }\n    }\n\n    return results;\n}\n\n\nexport function isAncestor(parent, child) {\n\n    let actualParent = getAncestor(child);\n\n    if (actualParent) {\n        if (actualParent === parent) {\n            return true;\n        }\n\n        return false;\n    }\n\n    if (child === parent) {\n        return false;\n    }\n\n    if (getTop(child) === child) {\n        return false;\n    }\n\n    for (let frame of getFrames(parent)) {\n        if (frame === child) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isPopup() {\n    return Boolean(getOpener(window));\n}\n\nexport function isIframe() {\n    return Boolean(getParent(window));\n}\n\nexport function isFullpage() {\n    return Boolean(!isIframe() && !isPopup());\n}\n\nexport function getWindowType() {\n    if (isPopup()) {\n        return CONSTANTS.WINDOW_TYPES.POPUP;\n    }\n    if (isIframe()) {\n        return CONSTANTS.WINDOW_TYPES.IFRAME;\n    }\n    return CONSTANTS.WINDOW_TYPES.FULLPAGE;\n}\n\n\nfunction anyMatch(collection1, collection2) {\n\n    for (let item1 of collection1) {\n        for (let item2 of collection2) {\n            if (item1 === item2) {\n                return true;\n            }\n        }\n    }\n}\n\nexport function isSameTopWindow(win1, win2) {\n\n    let top1 = getTop(win1);\n    let top2 = getTop(win2);\n\n    try {\n        if (top1 && top2) {\n            if (top1 === top2) {\n                return true;\n            }\n\n            return false;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    let allFrames1 = getAllFramesInWindow(win1);\n    let allFrames2 = getAllFramesInWindow(win2);\n\n    if (anyMatch(allFrames1, allFrames2)) {\n        return true;\n    }\n\n    let opener1 = getOpener(top1);\n    let opener2 = getOpener(top2);\n\n    if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n        return false;\n    }\n\n    if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n        return false;\n    }\n}\n\nexport function jsonStringify() {\n\n    let objectToJSON;\n    let arrayToJSON;\n\n    try {\n        if (JSON.stringify({}) !== '{}') {\n            objectToJSON = Object.prototype.toJSON;\n            delete Object.prototype.toJSON;\n        }\n\n        if (JSON.stringify({}) !== '{}') {\n            throw new Error(`Can not correctly serialize JSON objects`);\n        }\n\n        if (JSON.stringify([]) !== '[]') {\n            arrayToJSON  = Array.prototype.toJSON;\n            delete Array.prototype.toJSON;\n        }\n\n        if (JSON.stringify([]) !== '[]') {\n            throw new Error(`Can not correctly serialize JSON objects`);\n        }\n\n    } catch (err) {\n        throw new Error(`Can not repair JSON.stringify: ${err.message}`);\n    }\n\n    let result = JSON.stringify.apply(this, arguments);\n\n    try {\n        if (objectToJSON) {\n            Object.prototype.toJSON = objectToJSON; // eslint-disable-line\n        }\n\n        if (arrayToJSON) {\n            Array.prototype.toJSON = arrayToJSON; // eslint-disable-line\n        }\n\n    } catch (err) {\n        throw new Error(`Can not repair JSON.stringify: ${err.message}`);\n    }\n\n\n    return result;\n}\n\nexport function jsonParse() {\n    return JSON.parse.apply(this, arguments);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/windows.js","\nimport { CONSTANTS } from './conf';\nimport { cleanup } from './lib/cleanup';\n\nexport let global = window[CONSTANTS.WINDOW_PROPS.POSTROBOT] = window[CONSTANTS.WINDOW_PROPS.POSTROBOT] || {};\n\nglobal.clean = global.clean || cleanup(global);\n\n// Backwards compatibility\n\nglobal.registerSelf = () => {\n    // pass\n};\n\n\n// WEBPACK FOOTER //\n// ./src/global.js","\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\n\nexport function cleanup(obj) {\n\n    let tasks = [];\n\n    return {\n\n        getters: {\n            array:  () => { return []; },\n            object: () => { return {}; }\n        },\n\n        set(name, item) {\n            obj[name] = item;\n            this.register(() => {\n                delete obj[name];\n            });\n            return item;\n        },\n\n        push(collection, item) {\n            collection.push(item);\n            this.register(() => {\n                let index = collection.indexOf(item);\n                if (index !== -1) {\n                    collection.splice(index, 1);\n                }\n            });\n            return item;\n        },\n\n        setItem(mapping, key, item) {\n            mapping[key] = item;\n            this.register(() => {\n                delete mapping[key];\n            });\n            return item;\n        },\n\n        register(name, method) {\n\n            if (!method) {\n                method = name;\n                name = undefined;\n            }\n\n            tasks.push({\n                complete: false,\n\n                name,\n\n                run() {\n\n                    if (this.complete) {\n                        return;\n                    }\n\n                    this.complete = true;\n\n                    return method();\n                }\n            });\n        },\n\n        hasTasks() {\n            return Boolean(tasks.filter(item => !item.complete).length);\n        },\n\n        all() {\n            let results = [];\n\n            while (tasks.length) {\n                results.push(tasks.pop().run());\n            }\n\n            return Promise.all(results).then(() => {\n                return;\n            });\n        },\n\n        run(name) {\n            let results = [];\n            let toClean = [];\n\n            for (let item of tasks) {\n                if (item.name === name) {\n                    toClean.push(item);\n                    results.push(item.run());\n                }\n            }\n\n            for (let item of toClean) {\n                tasks.splice(tasks.indexOf(item), 1);\n            }\n\n            return Promise.all(results).then(() => {\n                return;\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/cleanup.js","\nimport { CONSTANTS } from '../conf';\nimport { util } from './util';\nimport { on, send } from '../interface';\nimport { log } from './log';\nimport { promise } from './promise';\nimport { global } from '../global';\n\nglobal.methods = global.methods || {};\n\nexport let listenForMethods = util.once(() => {\n    on(CONSTANTS.POST_MESSAGE_NAMES.METHOD, { window: '*', origin: '*' }, ({ source, origin, data }) => {\n\n        let meth = global.methods[data.id];\n\n        if (!meth) {\n            throw new Error(`Could not find method with id: ${data.id}`);\n        }\n\n        if (meth.destination !== source) {\n            throw new Error(`Method window does not match`);\n        }\n\n        if (meth.domain && meth.domain !== '*' && origin !== meth.domain) {\n            throw new Error(`Method domain ${meth.domain} does not match origin ${origin}`);\n        }\n\n        log.debug('Call local method', data.name, data.args);\n\n        return promise.run(() => {\n            return meth.method.apply({ source, origin, data }, data.args);\n\n        }).then(result => {\n\n            return {\n                result,\n                id: data.id,\n                name: data.name\n            };\n        });\n    });\n});\n\nfunction isSerialized(item, type) {\n    return typeof item === 'object' && item !== null && item.__type__ === type;\n}\n\nexport function serializeMethod(destination, domain, method, name) {\n\n    let id = util.uniqueID();\n\n    global.clean.setItem(global.methods, id, { destination, domain, method });\n\n    return {\n        __type__: CONSTANTS.SERIALIZATION_TYPES.METHOD,\n        __id__: id,\n        __name__: name\n    };\n}\n\nfunction serializeError(err) {\n    return {\n        __type__: CONSTANTS.SERIALIZATION_TYPES.ERROR,\n        __message__: err.stack || err.message || err.toString()\n    };\n}\n\nexport function serializeMethods(destination, domain, obj) {\n\n    return util.replaceObject({ obj }, (item, key) => {\n        if (typeof item === 'function') {\n            return serializeMethod(destination, domain, item, key);\n        }\n\n        if (item instanceof Error) {\n            return serializeError(item);\n        }\n    }).obj;\n}\n\nexport function deserializeMethod(source, origin, obj) {\n\n    function wrapper() {\n        let args = Array.prototype.slice.call(arguments);\n        log.debug('Call foreign method', obj.__name__, args);\n        return send(source, CONSTANTS.POST_MESSAGE_NAMES.METHOD, {\n            id: obj.__id__,\n            name: obj.__name__,\n            args\n\n        }, { domain: origin }).then(({ data }) => {\n\n            log.debug('Got foreign method result', obj.__name__, data.result);\n            return data.result;\n        }, err => {\n            log.debug('Got foreign method error', err.stack || err.toString());\n            throw err;\n        });\n    }\n\n    wrapper.__name__ = obj.__name__;\n    wrapper.source = source;\n    wrapper.origin = origin;\n\n    return wrapper;\n}\n\nexport function deserializeError(source, origin, obj) {\n    return new Error(obj.__message__);\n}\n\nexport function deserializeMethods(source, origin, obj) {\n\n    return util.replaceObject({ obj }, (item, key) => {\n\n        if (isSerialized(item, CONSTANTS.SERIALIZATION_TYPES.METHOD)) {\n            return deserializeMethod(source, origin, item);\n        }\n\n        if (isSerialized(item, CONSTANTS.SERIALIZATION_TYPES.ERROR)) {\n            return deserializeError(source, origin, item);\n        }\n\n    }).obj;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/methods.js","\nimport { CONSTANTS } from '../conf';\nimport { getAncestor } from './windows';\nimport { on, send } from '../interface';\nimport { log } from './log';\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\nimport { global } from '../global';\n\nglobal.readyPromises = global.readyPromises || [];\n\nexport function initOnReady() {\n\n    on(CONSTANTS.POST_MESSAGE_NAMES.READY, { window: '*', domain: '*' }, event => {\n\n        for (let item of global.readyPromises) {\n            if (item.win === event.source) {\n                item.promise.resolve(event);\n                return;\n            }\n        }\n\n        global.clean.push(global.readyPromises, {\n            win: event.source,\n            promise: new Promise().resolve(event)\n        });\n    });\n\n    let parent = getAncestor();\n\n    if (parent) {\n        send(parent, CONSTANTS.POST_MESSAGE_NAMES.READY, {}, { domain: '*' }).catch(err => {\n            log.debug(err.stack || err.toString());\n        });\n    }\n}\n\nexport function onWindowReady(win, timeout = 5000, name = 'Window') {\n\n    for (let item of global.readyPromises) {\n        if (item.win === win) {\n            return item.promise;\n        }\n    }\n\n    let promise = new Promise();\n\n    global.clean.push(global.readyPromises, { win, promise });\n\n    setTimeout(() => promise.reject(new Error(`${name} did not load after ${timeout}ms`)), timeout);\n\n    return promise;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/ready.js","\nexport * from './ie';\n\n\n// WEBPACK FOOTER //\n// ./src/compat/index.js","\nimport { CONFIG } from '../conf';\nimport { isSameTopWindow } from '../lib';\n\nexport function emulateIERestrictions(sourceWindow, targetWindow) {\n    if (!CONFIG.ALLOW_POSTMESSAGE_POPUP) {\n\n        if (isSameTopWindow(sourceWindow, targetWindow) === false) {\n            throw new Error(`Can not send and receive post messages between two different windows (disabled to emulate IE)`);\n        }\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/compat/ie.js","\nimport { CONSTANTS } from '../../conf';\nimport { promise, log, isWindowClosed } from '../../lib';\n\nimport { sendMessage } from '../send';\nimport { listeners, getRequestListener } from '../listeners';\n\nfunction matchDomain(domain, origin) {\n\n    if (typeof domain === 'string') {\n        return domain === '*' || origin === domain;\n    }\n\n    if (Object.prototype.toString.call(domain) === '[object RegExp]') {\n        return origin.match(domain);\n    }\n\n    if (Array.isArray(domain)) {\n        return domain.indexOf(origin) !== -1;\n    }\n\n    return false;\n}\n\nexport let RECEIVE_MESSAGE_TYPES = {\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.ACK ]: (source, origin, message) => {\n\n        let options = listeners.response[message.hash];\n\n        if (!options) {\n            throw new Error(`No handler found for post message ack for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Ack origin ${origin} does not match domain ${options.domain}`);\n        }\n\n        options.ack = true;\n    },\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.REQUEST ]: (source, origin, message) => {\n\n        let options = getRequestListener(message.name, source, origin);\n\n        function respond(data) {\n\n            if (message.fireAndForget || isWindowClosed(source)) {\n                return promise.Promise.resolve();\n            }\n\n            return sendMessage(source, {\n                target: message.originalSource,\n                hash: message.hash,\n                name: message.name,\n                ...data\n            }, origin);\n        }\n\n        return promise.Promise.all([\n\n            respond({\n                type: CONSTANTS.POST_MESSAGE_TYPE.ACK\n            }),\n\n            promise.run(() => {\n\n                if (!options) {\n                    throw new Error(`No handler found for post message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n                }\n\n                if (!matchDomain(options.domain, origin)) {\n                    throw new Error(`Request origin ${origin} does not match domain ${options.domain}`);\n                }\n\n                let data = message.data;\n\n                return promise.deNodeify(options.handler, { source, origin, data });\n\n            }).then(data => {\n\n                return respond({\n                    type: CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,\n                    ack: CONSTANTS.POST_MESSAGE_ACK.SUCCESS,\n                    data\n                });\n\n            }, err => {\n\n                return respond({\n                    type: CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,\n                    ack: CONSTANTS.POST_MESSAGE_ACK.ERROR,\n                    error: err.stack ? `${err.message}\\n${err.stack}` : err.toString()\n                });\n            })\n\n        ]).catch(err => {\n\n            if (options && options.handleError) {\n                return options.handleError(err);\n            } else {\n                log.error(err.stack || err.toString());\n            }\n        });\n    },\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.RESPONSE ]: (source, origin, message) => {\n\n        let options = listeners.response[message.hash];\n\n        if (!options) {\n            throw new Error(`No handler found for post message response for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Response origin ${origin} does not match domain ${options.domain}`);\n        }\n\n        delete listeners.response[message.hash];\n\n        if (message.ack === CONSTANTS.POST_MESSAGE_ACK.ERROR) {\n            return options.respond(new Error(message.error));\n        } else if (message.ack === CONSTANTS.POST_MESSAGE_ACK.SUCCESS) {\n            let data = message.data || message.response;\n\n            return options.respond(null, { source, origin, data });\n        }\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/receive/types.js","\nimport { CONSTANTS, CONFIG, POST_MESSAGE_NAMES_LIST } from '../../conf';\nimport { util, promise, serializeMethods, log, isWindowClosed, getWindowType, jsonStringify } from '../../lib';\n\nimport { SEND_MESSAGE_STRATEGIES } from './strategies';\n\n\nexport function buildMessage(win, message, options = {}) {\n\n    let id   = util.uniqueID();\n    let type = getWindowType();\n    let sourceDomain = util.getDomain(window);\n\n    return {\n        ...message,\n        ...options,\n        sourceDomain,\n        id:         message.id || id,\n        windowType: type\n    };\n}\n\n\nexport function sendMessage(win, message, domain) {\n    return promise.run(() => {\n\n        message = buildMessage(win, message, {\n            data: serializeMethods(win, domain, message.data),\n            domain\n        });\n\n        let level;\n\n        if (POST_MESSAGE_NAMES_LIST.indexOf(message.name) !== -1 || message.type === CONSTANTS.POST_MESSAGE_TYPE.ACK) {\n            level = 'debug';\n        } else if (message.ack === 'error') {\n            level = 'error';\n        } else {\n            level = 'info';\n        }\n\n        log.logLevel(level, [ '\\n\\n\\t', '#send', message.type.replace(/^postrobot_message_/, ''), '::', message.name, '::', domain || '*', '\\n\\n', message ]);\n\n        if (CONFIG.MOCK_MODE) {\n            delete message.target;\n            return window[CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({\n                origin: util.getDomain(window),\n                source: window,\n                data: jsonStringify(message, 0, 2)\n            });\n        }\n\n        if (win === window) {\n            throw new Error('Attemping to send message to self');\n        }\n\n        if (isWindowClosed(win)) {\n            throw new Error('Window is closed');\n        }\n\n        log.debug('Running send message strategies', message);\n\n        let messages = [];\n\n        let serializedMessage = jsonStringify({\n            [ CONSTANTS.WINDOW_PROPS.POSTROBOT ]: message\n        }, 0, 2);\n\n        return promise.map(Object.keys(SEND_MESSAGE_STRATEGIES), strategyName => {\n\n            return promise.run(() => {\n\n                if (!CONFIG.ALLOWED_POST_MESSAGE_METHODS[strategyName]) {\n                    throw new Error(`Strategy disallowed: ${strategyName}`);\n                }\n\n                return SEND_MESSAGE_STRATEGIES[strategyName](win, serializedMessage, domain);\n\n            }).then(() => {\n                messages.push(`${strategyName}: success`);\n                return true;\n            }, err => {\n                messages.push(`${strategyName}: ${err.stack || err.toString()}\\n`);\n                return false;\n            });\n\n        }).then(results => {\n\n            let success = util.some(results);\n            let status = `${message.type} ${message.name} ${success ? 'success' : 'error'}:\\n  - ${messages.join('\\n  - ')}\\n`;\n\n            log.debug(status);\n\n            if (!success) {\n                throw new Error(status);\n            }\n        });\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/send/index.js","\nimport { CONSTANTS } from '../../conf';\nimport { isSameDomain, isSameTopWindow } from '../../lib';\nimport { emulateIERestrictions } from '../../compat';\nimport { sendBridgeMessage } from '../../bridge';\n\nexport let SEND_MESSAGE_STRATEGIES = {\n\n    [ CONSTANTS.SEND_STRATEGIES.POST_MESSAGE ](win, serializedMessage, domain) {\n\n        emulateIERestrictions(window, win);\n\n        if (domain && domain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n            domain = `${win.location.protocol}//${win.location.host}`;\n        }\n\n        if (domain && domain.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n            domain = `*`;\n        }\n\n        return win.postMessage(serializedMessage, domain);\n    },\n\n    [ CONSTANTS.SEND_STRATEGIES.BRIDGE ](win, serializedMessage, domain) {\n\n        if (isSameDomain(win)) {\n            throw new Error(`Post message through bridge disabled between same domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use bridge to communicate between two different windows, not between frames`);\n        }\n\n        return sendBridgeMessage(win, serializedMessage, domain);\n    },\n\n    [ CONSTANTS.SEND_STRATEGIES.GLOBAL ](win, serializedMessage, domain) {\n\n        if (!isSameDomain(win)) {\n            throw new Error(`Post message through global disabled between different domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use global to communicate between two different windows, not between frames`);\n        }\n\n        let foreignGlobal = win[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n        \n        if (!foreignGlobal) {\n            throw new Error(`Can not find postRobot global on foreign window`);\n        }\n\n        return foreignGlobal.receiveMessage({\n            source: window,\n            origin: domain,\n            data: serializedMessage\n        });\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/send/strategies.js","\nexport * from './bridge';\nexport * from './child';\nexport * from './common';\nexport * from './parent';\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/index.js","\nimport { CONSTANTS } from '../conf';\nimport { getParent, isWindowClosed } from '../lib';\nimport { global } from '../global';\nimport { send } from '../interface';\n\nglobal.openTunnelToParent = function openTunnelToParent({ name, source, canary, sendMessage }) {\n\n    let remoteWindow = getParent(window);\n\n    if (!remoteWindow) {\n        throw new Error(`No parent window found to open tunnel to`);\n    }\n\n    return send(remoteWindow, CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL, {\n        name,\n        sendMessage() {\n\n            if (isWindowClosed(source)) {\n                return;\n            }\n\n            try {\n                canary();\n            } catch (err) {\n                return;\n            }\n\n            sendMessage.apply(this, arguments);\n        }\n    }, { domain: '*' });\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/bridge.js","\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\nimport { CONSTANTS } from '../conf';\nimport { isSameDomain, getOpener, getFrames, util, getFrameByName } from '../lib';\nimport { receiveMessage } from '../drivers';\n\nimport { needsBridge, registerRemoteWindow, rejectRemoteSendMessage, registerRemoteSendMessage, getBridgeName } from './common';\n\nfunction getRemoteBridgeForWindow(win) {\n    return Promise.try(() => {\n        for (let frame of getFrames(win)) {\n            try {\n                if (frame && frame !== window && isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                    return frame;\n                }\n\n            } catch (err) {\n                continue;\n            }\n        }\n\n        try {\n            let frame = getFrameByName(win, getBridgeName(util.getDomain()));\n\n            if (!frame) {\n                return;\n            }\n\n            if (isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                return frame;\n            }\n\n            return new Promise(resolve => {\n\n                let interval;\n                let timeout;\n\n                interval = setInterval(() => {\n                    if (isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                        clearInterval(interval);\n                        clearTimeout(timeout);\n                        return resolve(frame);\n                    }\n\n                    setTimeout(() => {\n                        clearInterval(interval);\n                        return resolve();\n                    }, 2000);\n                }, 100);\n            });\n\n        } catch (err) {\n            return;\n        }\n    });\n}\n\nexport function openTunnelToOpener() {\n    return Promise.try(() => {\n\n        let opener = getOpener(window);\n\n        if (!opener) {\n            return;\n        }\n\n        if (!needsBridge({ win: opener })) {\n            return;\n        }\n\n        registerRemoteWindow(opener);\n\n        return getRemoteBridgeForWindow(opener).then(bridge => {\n\n            if (!bridge) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: no bridge found in opener`));\n            }\n\n            if (!window.name) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: window does not have a name`));\n            }\n\n            return bridge[CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({\n\n                name: window.name,\n\n                source: window,\n\n                canary() {\n                    // pass\n                },\n\n                sendMessage(message) {\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    receiveMessage({\n                        data:   message,\n                        origin: this.origin,\n                        source: this.source\n                    });\n                }\n\n            }).then(({ source, origin, data }) => {\n\n                if (source !== opener) {\n                    throw new Error(`Source does not match opener`);\n                }\n\n                registerRemoteSendMessage(source, origin, data.sendMessage);\n\n            }).catch(err => {\n\n                rejectRemoteSendMessage(opener, err);\n                throw err;\n            });\n        });\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/child.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { util, promise, isSameDomain, isOpener, isSameTopWindow, getUserAgent } from '../lib';\nimport { global } from '../global';\nimport { receiveMessage } from '../drivers';\n\nexport function needsBridgeForBrowser() {\n\n    if (getUserAgent(window).match(/MSIE|trident|edge/i)) {\n        return true;\n    }\n\n    if (!CONFIG.ALLOW_POSTMESSAGE_POPUP) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForWin(win) {\n\n    if (win && isSameTopWindow(window, win)) {\n        return false;\n    }\n\n    if (win && isSameDomain(win)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function needsBridgeForDomain(domain) {\n\n    if (domain && util.getDomain() === util.getDomainFromUrl(domain)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function needsBridge({ win, domain }) {\n    return needsBridgeForBrowser() && needsBridgeForWin(win) && needsBridgeForDomain(domain);\n}\n\nexport function getBridgeName(domain) {\n\n    domain = domain || util.getDomainFromUrl(domain);\n\n    let sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, '_');\n\n    let id = `${CONSTANTS.BRIDGE_NAME_PREFIX}_${sanitizedDomain}`;\n\n    return id;\n}\n\nexport function isBridge() {\n    return window.name && window.name === getBridgeName(util.getDomain());\n}\n\nexport let documentBodyReady = new promise.Promise(resolve => {\n\n    if (window.document && window.document.body) {\n        return resolve(window.document.body);\n    }\n\n    let interval = setInterval(() => {\n        if (window.document && window.document.body) {\n            clearInterval(interval);\n            return resolve(window.document.body);\n        }\n    }, 10);\n});\n\nglobal.remoteWindows = global.remoteWindows || [];\n\nexport function registerRemoteWindow(win, timeout = CONFIG.BRIDGE_TIMEOUT) {\n    let sendMessagePromise = new promise.Promise();\n    global.clean.push(global.remoteWindows, { win, sendMessagePromise });\n}\n\nexport function findRemoteWindow(win) {\n    for (let i = 0; i < global.remoteWindows.length; i++) {\n        if (global.remoteWindows[i].win === win) {\n            return global.remoteWindows[i];\n        }\n    }\n}\n\nexport function registerRemoteSendMessage(win, domain, sendMessage) {\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found to register sendMessage to`);\n    }\n\n    let sendMessageWrapper = (remoteWin, message, remoteDomain) => {\n\n        if (remoteWin !== win) {\n            throw new Error(`Remote window does not match window`);\n        }\n\n        if (remoteDomain !== `*` && remoteDomain !== domain) {\n            throw new Error(`Remote domain ${remoteDomain} does not match domain ${domain}`);\n        }\n\n        sendMessage(message);\n    };\n\n    remoteWindow.sendMessagePromise.resolve(sendMessageWrapper);\n    remoteWindow.sendMessagePromise = promise.Promise.resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(win, err) {\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found on which to reject sendMessage`);\n    }\n\n    remoteWindow.sendMessagePromise.asyncReject(err);\n}\n\nexport function sendBridgeMessage(win, message, domain) {\n\n    let messagingChild  = isOpener(window, win);\n    let messagingParent = isOpener(win, window);\n\n    if (!messagingChild && !messagingParent) {\n        throw new Error(`Can only send messages to and from parent and popup windows`);\n    }\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found to send message to`);\n    }\n\n    return remoteWindow.sendMessagePromise.then(sendMessage => {\n        return sendMessage(win, message, domain);\n    });\n}\n\nglobal.receiveMessage = function(event) {\n    return receiveMessage(event);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/common.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { util, promise, log, onWindowReady, getFrameByName } from '../lib';\nimport { global } from '../global';\nimport { on } from '../interface';\nimport { receiveMessage } from '../drivers';\n\nglobal.bridges = global.bridges || {};\n\nimport { getBridgeName, documentBodyReady, registerRemoteSendMessage, registerRemoteWindow } from './common';\n\nfunction listenForRegister(source, domain) {\n    on(CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL, { source, domain }, ({ origin, data }) => {\n\n        if (origin !== domain) {\n            throw new Error(`Domain ${domain} does not match origin ${origin}`);\n        }\n\n        if (!data.name) {\n            throw new Error(`Register window expected to be passed window name`);\n        }\n\n        if (!data.sendMessage) {\n            throw new Error(`Register window expected to be passed sendMessage method`);\n        }\n\n        let winDetails = global.popupWindows[data.name];\n\n        if (!winDetails) {\n            throw new Error(`Window with name ${data.name} does not exist, or was not opened by this window`);\n        }\n\n        if (!winDetails.domain) {\n            throw new Error(`We do not have a registered domain for window ${data.name}`);\n        }\n\n        if (winDetails.domain !== origin) {\n            throw new Error(`Message origin ${origin} does not matched registered window origin ${winDetails.domain}`);\n        }\n\n        registerRemoteSendMessage(winDetails.win, domain, data.sendMessage);\n\n        return {\n            sendMessage(message) {\n\n                if (!window || window.closed) {\n                    return;\n                }\n\n                receiveMessage({\n                    data:   message,\n                    origin: winDetails.domain,\n                    source: winDetails.win\n                });\n            }\n        };\n    });\n}\n\nfunction openBridgeFrame(name, url) {\n\n    log.debug(`Opening bridge:`, name, url);\n\n    let iframe = document.createElement(`iframe`);\n\n    iframe.setAttribute(`name`, name);\n    iframe.setAttribute(`id`,   name);\n\n    iframe.setAttribute(`style`, `display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;`);\n    iframe.setAttribute(`frameborder`, `0`);\n    iframe.setAttribute(`border`, `0`);\n    iframe.setAttribute(`scrolling`, `no`);\n    iframe.setAttribute(`allowTransparency`, `true`);\n\n    iframe.setAttribute(`tabindex`, `-1`);\n    iframe.setAttribute(`hidden`, `true`);\n    iframe.setAttribute(`title`, ``);\n    iframe.setAttribute(`role`, `presentation`);\n\n    iframe.src = url;\n\n    return iframe;\n}\n\nexport function openBridge(url, domain) {\n\n    domain = domain || util.getDomainFromUrl(url);\n\n    if (global.bridges[domain]) {\n        return global.bridges[domain];\n    }\n\n    return global.clean.setItem(global.bridges, domain, promise.run(() => {\n\n        if (util.getDomain() === domain) {\n            throw new Error(`Can not open bridge on the same domain as current domain: ${domain}`);\n        }\n\n        let name  = getBridgeName(domain);\n        let frame = getFrameByName(window, name);\n\n        if (frame) {\n            throw new Error(`Frame with name ${name} already exists on page`);\n        }\n\n        let iframe = openBridgeFrame(name, url);\n\n        return documentBodyReady.then(body => {\n\n            return new promise.Promise((resolve, reject) => {\n\n                setTimeout(resolve, 1);\n\n            }).then(() => {\n\n                body.appendChild(iframe);\n\n                global.clean.register('bridgeFrames', () => {\n                    body.removeChild(iframe);\n                    delete global.bridges[domain];\n                });\n\n                let bridge = iframe.contentWindow;\n\n                listenForRegister(bridge, domain);\n\n                return new promise.Promise((resolve, reject) => {\n\n                    iframe.onload = resolve;\n                    iframe.onerror = reject;\n\n                }).then(() => {\n\n                    return onWindowReady(bridge, CONFIG.BRIDGE_TIMEOUT, `Bridge ${url}`);\n\n                }).then(() => {\n\n                    return bridge;\n                });\n            });\n        });\n    }));\n}\n\nexport function destroyBridges() {\n    return global.clean.run('bridgeFrames');\n}\n\nglobal.popupWindows = global.popupWindows || {};\n\nlet windowOpen = window.open;\n\nwindow.open = function(url, name, options, last) {\n\n    let domain = url;\n\n    if (url && url.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n        [ domain, url ] = url.split('|');\n    }\n\n    if (domain) {\n        domain = util.getDomainFromUrl(domain);\n    }\n\n    let win = windowOpen.call(this, url, name, options, last);\n\n    if (url) {\n        registerRemoteWindow(win);\n    }\n\n    if (name) {\n        global.clean.setItem(global.popupWindows, name, { win, domain });\n    }\n\n    return win;\n};\n\nexport function linkUrl(win, url) {\n\n    for (let name of Object.keys(global.popupWindows)) {\n        let winOptions = global.popupWindows[name];\n\n        if (winOptions.win === win) {\n            winOptions.domain = util.getDomainFromUrl(url);\n\n            registerRemoteWindow(win);\n\n            break;\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/parent.js","\nimport { global } from '../global';\n\nglobal.listeners = global.listeners || {\n    request: [],\n    response: []\n};\n\nexport let listeners = global.listeners;\n\nexport function resetListeners() {\n    global.listeners.request = [];\n    global.listeners.response = [];\n}\n\nfunction isRegex(item) {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\nfunction matchDomain(domain, origin) {\n\n    if (typeof domain === 'string') {\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        return domain === '*' || origin === domain;\n    }\n\n    if (isRegex(domain)) {\n\n        if (isRegex(origin)) {\n            return domain.toString() === origin.toString();\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        return origin.match(domain);\n    }\n\n    if (Array.isArray(domain)) {\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return JSON.stringify(domain) === JSON.stringify(origin);\n        }\n\n        return domain.indexOf(origin) !== -1;\n    }\n\n    return false;\n}\n\nexport function getRequestListener(name, win, domain) {\n\n    let result = {};\n\n    for (let requestListener of global.listeners.request) {\n\n        if (requestListener.name !== name) {\n            continue;\n        }\n\n        let specifiedWin = (requestListener.win && requestListener.win !== '*');\n        let specifiedDomain = (requestListener.domain && requestListener.domain !== '*');\n\n        let matchedWin = (specifiedWin && requestListener.win === win);\n        let matchedDomain = (specifiedDomain && matchDomain(requestListener.domain, domain));\n\n        if (specifiedWin && specifiedDomain) {\n            if (matchedWin && matchedDomain) {\n                result.all = result.all || requestListener.options;\n            }\n        } else if (specifiedDomain) {\n            if (matchedDomain) {\n                result.domain = result.domain || requestListener.options;\n            }\n        } else if (specifiedWin) {\n            if (matchedWin) {\n                result.win = result.win || requestListener.options;\n            }\n        } else {\n            result.name = result.name || requestListener.options;\n        }\n    }\n\n    return result.all || result.domain || result.win || result.name;\n}\n\nexport function removeRequestListener(options) {\n\n    for (let listener of global.listeners.request) {\n        if (listener.options === options) {\n            global.listeners.request.splice(global.listeners.request.indexOf(listener), 1);\n        }\n    }\n}\n\nexport function addRequestListener(name, win, domain, options, override) {\n\n    let listener = getRequestListener(name, win, domain);\n\n    if (listener) {\n        if (override) {\n            removeRequestListener(listener);\n        } else {\n\n            if (win) {\n                throw new Error(`Request listener already exists for ${name} on domain ${domain} for specified window: ${listener.win === win}`);\n            }\n\n            throw new Error(`Request listener already exists for ${name} on domain ${domain}`);\n        }\n    }\n\n    global.clean.push(global.listeners.request, { name, win, domain, options });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/listeners.js","\nimport { CONFIG } from '../conf';\nimport { util, promise, isWindowClosed } from '../lib';\nimport { addRequestListener, removeRequestListener } from '../drivers';\n\nexport function listen(options) {\n\n    if (!options.name) {\n        throw new Error('Expected options.name');\n    }\n\n    options.handler = options.handler || util.noop;\n\n    options.errorHandler = options.errorHandler || function(err) {\n        throw err;\n    };\n\n    if (options.once) {\n        let handler = options.handler;\n        options.handler = util.once(function() {\n            removeRequestListener(options);\n            return handler.apply(this, arguments);\n        });\n    }\n\n    let override = options.override || CONFIG.MOCK_MODE;\n\n    if (options.source) {\n        options.window = options.source;\n    }\n\n    options.domain = options.domain || '*';\n\n    addRequestListener(options.name, options.window, options.domain, options, override);\n\n    options.handleError = err => {\n        // removeRequestListener(options);\n        options.errorHandler(err);\n    };\n\n    if (options.window && options.errorOnClose) {\n        let interval = util.safeInterval(() => {\n            if (isWindowClosed(options.window)) {\n                interval.cancel();\n                options.handleError(new Error('Post message target window is closed'));\n            }\n        }, 50);\n    }\n\n    return {\n        cancel() {\n            removeRequestListener(options);\n        }\n    };\n}\n\nexport function on(name, options, handler, errorHandler) {\n\n    if (typeof options === 'function') {\n        errorHandler = handler;\n        handler = options;\n        options = {};\n    }\n\n    options = options || {};\n\n    options.name = name;\n    options.handler = handler || options.handler;\n    options.errorHandler = errorHandler || options.errorHandler;\n\n    return listen(options);\n}\n\nexport function once(name, options, handler, errorHandler) {\n\n    if (typeof options === 'function') {\n        errorHandler = handler;\n        handler = options;\n        options = {};\n    }\n\n    options = options || {};\n\n    options.name = name;\n    options.handler = handler || options.handler;\n    options.errorHandler = errorHandler || options.errorHandler;\n    options.once = true;\n\n    let prom = new promise.Promise((resolve, reject) => {\n        options.handler = options.handler || (event => resolve(event));\n        options.errorHandler = options.errorHandler || reject;\n    });\n\n    let myListener = listen(options);\n\n    util.extend(prom, myListener);\n\n    return prom;\n}\n\nexport function listener(options = {}) {\n\n    return {\n        on(name, handler, errorHandler) {\n            return on(name, options, handler, errorHandler);\n        }\n    };\n}\n\n\n// WEBPACK FOOTER //\n// ./src/interface/server.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { messageListener } from '../drivers';\n\nexport function enableMockMode() {\n    CONFIG.MOCK_MODE = true;\n}\n\nexport function disableMockMode() {\n    CONFIG.MOCK_MODE = false;\n}\n\nexport { CONFIG, CONSTANTS } from '../conf';\n\nexport function disable() {\n    delete window[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n    window.removeEventListener('message', messageListener);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/interface/config.js"],"sourceRoot":""}